# 《地球新章》游戏设计文档 (GDD)

**版本**: 1.0
**日期**: 2025年12月25日
**游戏名称**: 地球新章 (DQXZ)
**游戏类型**: LBS生存策略游戏
**目标平台**: iOS

---

## 1. 游戏概述

### 1.1 高概念 (High Concept)
《地球新章》是一款将真实世界行走与末日生存策略相结合的LBS手游。玩家通过现实中的GPS移动来圈占虚拟领地，探索真实地标获取资源，建造基地设施，与其他幸存者交易互助，共同在废土上重建文明。

**一句话描述**: 用脚步丈量你的王国，在末日废土上重建希望。

### 1.2 核心玩法循环
```
┌──────────────────────────────────────────────────────────┐
│                    核心游戏循环                           │
├──────────────────────────────────────────────────────────┤
│                                                          │
│   登录注册 → 圈地占领 → 探索搜刮 → 获得资源                │
│      ↑                              ↓                    │
│      │         ┌──────────────────────────────┐         │
│      │         │  资源消耗出口：               │         │
│      │         │  • 建造建筑（消耗资源）        │         │
│      │         │  • 交易换物（流通资源）        │         │
│      │         │  • 生存消耗（食物/水）         │         │
│      │         └──────────────────────────────┘         │
│      │                              ↓                    │
│      └──────── 通讯社交 ← 成就排行 ← 发展壮大            │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 1.3 核心乐趣点
| 乐趣类型 | 描述 |
|---------|------|
| 探索发现 | 现实世界的行走带来虚拟世界的发现惊喜 |
| 领地扩张 | 用双脚丈量的土地归自己所有的成就感 |
| 资源经营 | 收集、管理、运用资源的策略乐趣 |
| 社交互动 | 与附近玩家交易、聊天的真实社交 |
| 生存挑战 | 维持生存指标的紧迫感与满足感 |

---

## 2. 世界观与叙事

### 2.1 故事背景

#### 时间线
| 时间 | 事件 |
|------|------|
| 2048年 | "终末战争"爆发，全球文明在72小时内崩塌 |
| 2048-2051年 | 黑暗时期，99%人口消失，文明断绝 |
| 2051年 | 幸存者从避难所走出，《新开拓者协议》颁布 |
| 2051年至今 | 重建纪元，玩家加入开拓者行列 |

#### 《新开拓者协议》核心条款
> **第一条**: 凡以双足丈量之无主土地，皆为开拓者所有。
>
> **第二条**: 开拓者须在30天内开始建设，90天内保持活跃，否则土地回收。
>
> **第三条**: 开拓者之间应互助合作，以物易物，共建新世界。
>
> **第四条**: 不得侵占他人已圈定的领地。

### 2.2 视觉风格

**"希望朋克" (Hope Punk)**

| 元素 | 描述 |
|------|------|
| 色调 | 废土灰棕色为底，点缀生机盎然的绿色 |
| 建筑 | 破败的旧世界建筑上生长着新植物 |
| UI风格 | 卫星地图风格，军用科技感 |
| 图标 | 粗犷的手绘风格，末日工业感 |
| 动效 | 微弱光芒、植物生长、希望闪烁 |

### 2.3 音效设计
| 场景 | 音效类型 |
|------|---------|
| 主界面 | 风声、远处鸟鸣、废墟回响 |
| 圈地成功 | 胜利号角、领土宣告 |
| 搜刮获得 | 金属碰撞、物品入袋 |
| 建造完成 | 锤击、焊接、建筑落成 |
| 交易完成 | 握手音效、交换声 |
| 生存警告 | 心跳加速、警报声 |

---

## 3. 游戏系统设计

### 3.1 圈地系统

#### 3.1.1 基础机制
玩家通过现实世界的GPS移动来绘制领地边界。当轨迹形成闭合多边形时，该区域成为玩家的领地。

#### 3.1.2 圈地规则
| 规则项 | 数值/描述 |
|--------|---------|
| 最小面积 | 100平方米 |
| 最大单次面积 | 100,000平方米（10万m²） |
| 闭合触发距离 | 距起点20米内自动闭合 |
| GPS采样间隔 | 1秒 |
| 最低有效速度 | 0.5 m/s（防止原地画圈） |
| 最高有效速度 | 10 m/s（防止开车作弊） |

#### 3.1.3 领地验证
| 验证项 | 失败处理 |
|--------|---------|
| 与他人领地重叠 | 拒绝圈地，提示冲突区域 |
| 速度异常 | 标记为疑似作弊，需人工审核 |
| 形状不规则 | 自动简化为凸多边形 |
| 跨越障碍物（河流、高速公路） | 允许，但建议沿道路行走 |

#### 3.1.4 领地状态
```
┌─────────┐    30天无建设    ┌─────────┐    90天不活跃    ┌─────────┐
│  活跃   │ ───────────────→ │  警告   │ ───────────────→ │  回收   │
└─────────┘                  └─────────┘                  └─────────┘
     ↑                            │
     │         开始建设/活动       │
     └────────────────────────────┘
```

---

### 3.2 探索与搜刮系统

#### 3.2.1 POI类型与资源产出

| POI类型 | 地点示例 | 主产出 | 副产出 | 搜刮冷却 |
|---------|---------|--------|--------|---------|
| 医疗 | 医院、药店、诊所 | 药品×5-10 | 绷带×2-5 | 4小时 |
| 食品 | 超市、餐厅、便利店 | 罐头×5-15 | 饮用水×3-8 | 2小时 |
| 工业 | 工厂、工地、仓库 | 金属×8-12 | 零件×2-4 | 6小时 |
| 自然 | 公园、林地、农田 | 木材×10-20 | 植物纤维×5-10 | 3小时 |
| 金融 | 银行、珠宝店 | 稀有材料×1-3 | 电子元件×2-5 | 12小时 |
| 教育 | 学校、图书馆 | 书籍×3-6 | 文具×2-4 | 4小时 |
| 交通 | 加油站、车站 | 燃料×5-8 | 工具×1-3 | 4小时 |

#### 3.2.2 探索机制
| 参数 | 数值 |
|------|------|
| POI发现距离 | 50米范围内触发 |
| 搜刮执行距离 | 30米范围内可搜刮 |
| 每日探索上限 | 无VIP：20次 / VIP：无限 |
| 资源随机浮动 | ±30% |

#### 3.2.3 探索奖励公式
```
基础产出 = POI类型基础值 × 随机系数(0.7~1.3)
最终产出 = 基础产出 × (1 + VIP加成) × (1 + 体征buff)
```

---

### 3.3 资源与物品系统

#### 3.3.1 资源分类

| 类别 | 资源类型 | 主要用途 |
|------|---------|---------|
| 消耗品 | 罐头、饮用水、药品 | 恢复生存体征 |
| 基础材料 | 木材、石头、金属 | 建造Tier 1建筑 |
| 进阶材料 | 电子元件、燃料、玻璃 | 建造Tier 2建筑 |
| 稀有材料 | 卫星模块、太阳能电池 | 建造Tier 3建筑 |
| 工具 | 锤子、锯子、焊枪 | 加速建造/修复 |

#### 3.3.2 背包系统

| 参数 | 数值 |
|------|------|
| 初始容量 | 100格 |
| 单格最大堆叠 | 99个（同类物品） |
| 扩容方式 | 建造仓库建筑 |
| 小仓库增加 | +50格 |
| 中仓库增加 | +100格 |
| 大仓库增加 | +200格 |

#### 3.3.3 物品稀有度
| 稀有度 | 颜色 | 爆率 | 示例 |
|--------|------|------|------|
| 普通 | 白色 | 60% | 木材、石头、罐头 |
| 精良 | 绿色 | 25% | 金属、药品、工具 |
| 稀有 | 蓝色 | 12% | 电子元件、燃料 |
| 史诗 | 紫色 | 2.5% | 太阳能电池、卫星零件 |
| 传说 | 橙色 | 0.5% | 卫星模块、核心芯片 |

---

### 3.4 建造系统

#### 3.4.1 建筑等级体系

**Tier 1 - 生存基础**
| 建筑名称 | 所需资源 | 建造时间 | 功能 |
|---------|---------|---------|------|
| 篝火 | 石头×20, 木材×30 | 5分钟 | 提供温暖buff |
| 简易庇护所 | 木材×50, 布料×20 | 15分钟 | 提供休息点 |
| 储水桶 | 金属×15, 木材×10 | 10分钟 | 储存饮用水 |
| 小仓库 | 木材×80, 金属×20 | 30分钟 | 增加50格容量 |

**Tier 2 - 功能扩展**
| 建筑名称 | 所需资源 | 建造时间 | 功能 |
|---------|---------|---------|------|
| 农田 | 木材×100, 种子×10 | 1小时 | 每日产出食物 |
| 工作台 | 金属×80, 工具×5 | 1小时 | 制作高级物品 |
| 中仓库 | 木材×150, 金属×50 | 2小时 | 增加100格容量 |
| 营地电台 | 金属×60, 电子元件×10 | 1.5小时 | 扩大通讯范围至10km |

**Tier 3 - 高级设施**
| 建筑名称 | 所需资源 | 建造时间 | 功能 |
|---------|---------|---------|------|
| 太阳能板 | 金属×100, 太阳能电池×5 | 3小时 | 提供电力 |
| 风力发电机 | 金属×150, 电子元件×20 | 4小时 | 提供更多电力 |
| 卫星通讯站 | 卫星模块×3, 电子元件×30 | 6小时 | 全球通讯能力 |
| 大仓库 | 金属×200, 木材×300 | 5小时 | 增加200格容量 |

#### 3.4.2 建筑状态机
```
建造中(Building)
    │
    ↓ 建造完成
待激活(Pending)
    │
    ↓ 玩家激活
运行中(Active)
    │
    ├────→ 正常运行，提供功能
    │
    ↓ 资源耗尽/受损
损坏(Damaged)
    │
    ↓ 消耗资源修复
运行中(Active)
```

#### 3.4.3 建筑维护
| 建筑等级 | 维护周期 | 维护消耗 |
|---------|---------|---------|
| Tier 1 | 7天 | 原建造资源的10% |
| Tier 2 | 5天 | 原建造资源的15% |
| Tier 3 | 3天 | 原建造资源的20% |

---

### 3.5 交易系统

#### 3.5.1 交易机制
以物易物是新世界的主要交易方式。玩家可以发布自己愿意交换的物品和想要的物品，附近的玩家可以响应交易。

#### 3.5.2 交易规则
| 规则项 | 数值/描述 |
|--------|---------|
| 可见距离 | 100米范围内可看到对方挂单 |
| 挂单有效期 | 24小时 |
| 同时挂单数 | 最多5个 |
| 交易冷却 | 同一玩家间隔1小时 |
| 领地交易开关 | 需开启才能在领地内被发现 |

#### 3.5.3 交易流程
```
发起者                                接收者
   │                                    │
   ├── 发布挂单 ─────────────────────→  │
   │   (我提供A, 我需要B)                │
   │                                    │
   │                     进入100米范围 ──┤
   │                                    │
   │  ←───────────────── 看到挂单列表 ──┤
   │                                    │
   │  ←─────────────────── 接受交易 ────┤
   │                                    │
   ├── 物品交换 ─────────────────────→  │
   │   (A给接收者, B给发起者)            │
   │                                    │
  完成                                 完成
```

---

### 3.6 生存体征系统

#### 3.6.1 核心指标
| 指标 | 最大值 | 初始值 | 衰减速率 | 影响 |
|------|--------|--------|---------|------|
| 核心生命 | 100 | 100 | 依赖其他指标 | 归零即死亡 |
| 饱食度 | 100% | 80% | -5%/小时 | <30%时生命-2/小时 |
| 水分 | 100% | 80% | -10%/小时 | <30%时生命-3/小时 |

#### 3.6.2 状态效果
| 条件 | 效果名称 | 描述 |
|------|---------|------|
| 饱食度 ≥80% AND 水分 ≥80% | 精力充沛 | 探索获得资源+20% |
| 饱食度 <30% | 饥饿 | 移动速度-20%，生命衰减 |
| 水分 <30% | 脱水 | 探索效率-30%，生命衰减 |
| 生命 <30% | 虚弱 | 无法进行建造 |
| 生命 = 0 | 死亡 | 丢失30%资源，重生在领地 |

#### 3.6.3 恢复物品
| 物品 | 恢复效果 |
|------|---------|
| 罐头食品 | 饱食度+15% |
| 新鲜食物 | 饱食度+25% |
| 饮用水 | 水分+20% |
| 能量饮料 | 水分+10%, 饱食度+5% |
| 药品 | 生命+20 |
| 急救包 | 生命+50 |

---

### 3.7 通讯系统

#### 3.7.1 通讯设备等级
| 设备 | 解锁条件 | 范围 | 功能 |
|------|---------|------|------|
| 收音机 | 初始拥有 | 3km | 仅接收，不能发送 |
| 对讲机 | 消耗金属×50 | 3km | 可收发消息 |
| 营地电台 | 建造营地电台建筑 | 10km | 扩大范围 |
| 卫星通讯 | 建造卫星通讯站 | 全球 | 全球频道 |

#### 3.7.2 频道类型
| 频道类型 | 描述 | 限制 |
|---------|------|------|
| 公共频道 | 所有玩家可见 | 受设备范围限制 |
| 私人频道 | 玩家创建的群组 | 需加入才能看到 |
| 官方频道 | 系统公告 | 只读 |

#### 3.7.3 PTT (Push-To-Talk) 机制
- 长按麦克风按钮录制语音
- 松开后转换为文字消息发送
- 模拟真实对讲机操作体验

---

### 3.8 成就系统

#### 3.8.1 成就分类

**新手成就**
| 成就名称 | 条件 | 奖励 |
|---------|------|------|
| 初来乍到 | 完成首次登录 | 金币×100 |
| 新手领主 | 完成第一次圈地 | 金币×200 |
| 末世拾荒者 | 完成第一次搜刮 | 金币×150 |
| 建设者 | 建造第一个建筑 | 金币×200 |

**进阶成就**
| 成就名称 | 条件 | 奖励 |
|---------|------|------|
| 地产大亨 | 拥有5块领地 | 金币×1000 |
| 资源富翁 | 背包中拥有500件物品 | 金币×800 |
| 基建狂魔 | 建造20个建筑 | 金币×1500 |
| 社交达人 | 完成50次交易 | 金币×1200 |

**稀有成就**
| 成就名称 | 条件 | 奖励 |
|---------|------|------|
| 领土霸主 | 总领地面积超过100,000m² | 金币×5000 + 专属头衔 |
| 生存大师 | 连续30天保持体征满状态 | 金币×3000 + 专属头像框 |
| 探索先锋 | 探索1000个不同POI | 金币×8000 + 专属徽章 |

#### 3.8.2 稀有度等级
| 稀有度 | 颜色 | 代表含义 |
|--------|------|---------|
| 普通 | 灰色 | 基础任务 |
| 稀有 | 蓝色 | 需要一定积累 |
| 史诗 | 紫色 | 需要长期努力 |
| 传说 | 橙色 | 极少数玩家能达成 |

---

### 3.9 排行榜系统

#### 3.9.1 榜单类型
| 榜单 | 排序依据 | 更新频率 |
|------|---------|---------|
| 领地面积榜 | 总领地面积（m²） | 5分钟 |
| 探索废墟榜 | 累计探索POI数量 | 5分钟 |
| 建筑数量榜 | 已建造建筑总数 | 5分钟 |
| 存活时长榜 | 注册天数 | 每日 |

#### 3.9.2 排行榜展示
- 显示前100名玩家
- 显示玩家自己的排名（无论是否在前100）
- 前3名有特殊标识（金银铜）
- 支持周榜/月榜/总榜切换

---

## 4. 经济系统设计

### 4.1 货币体系
| 货币 | 获取方式 | 用途 |
|------|---------|------|
| 金币 | 成就奖励、每日任务 | 购买装饰、加速建造 |
| 钻石 | 付费购买 | 购买高级道具、VIP |

### 4.2 付费系统

#### 4.2.1 订阅制
| 订阅类型 | 价格 | 权益 |
|---------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索次数、探索范围+50% |
| 领主通行证 | $19.99/月 | 包含月卡权益 + 建造加速50% + 专属标识 |

#### 4.2.2 资源包
| 资源包 | 价格 | 内容 |
|--------|------|------|
| 初级物资包 | $0.99 | 罐头×30, 饮用水×20, 药品×10 |
| 中级物资包 | $2.99 | 金属×50, 木材×100, 电子元件×5 |
| 高级物资包 | $9.99 | 稀有材料×10, 卫星模块×1, 金币×1000 |

### 4.3 资源平衡

#### 4.3.1 日均资源收入（活跃玩家）
| 来源 | 食物 | 水 | 木材 | 金属 |
|------|-----|-----|-----|-----|
| 探索搜刮(20次) | 50 | 30 | 80 | 40 |
| 农田产出(1个) | 20 | 0 | 0 | 0 |
| 每日任务 | 10 | 10 | 20 | 10 |
| **日均总计** | **80** | **40** | **100** | **50** |

#### 4.3.2 日均资源消耗（活跃玩家）
| 消耗项 | 食物 | 水 | 木材 | 金属 |
|--------|-----|-----|-----|-----|
| 生存消耗(维持体征) | 30 | 50 | 0 | 0 |
| 建筑维护 | 0 | 0 | 20 | 10 |
| 建造新建筑(平均) | 0 | 0 | 30 | 15 |
| **日均总计** | **30** | **50** | **50** | **25** |

**结论**: 活跃玩家资源收入>消耗，形成正循环；非活跃玩家将面临资源紧张。

---

## 5. 用户体验设计

### 5.1 新手引导流程
```
1. 开场动画：展示末日背景故事
           ↓
2. 创建角色：设置昵称
           ↓
3. 首次圈地教程：引导完成第一块领地
           ↓
4. 首次探索教程：带领探索附近POI
           ↓
5. 首次建造教程：建造第一个篝火
           ↓
6. 自由探索：开放所有功能
```

### 5.2 UI/UX原则
| 原则 | 说明 |
|------|------|
| 沉浸感 | 末日主题贯穿，音效氛围配合 |
| 清晰性 | 关键信息一目了然（体征、资源） |
| 反馈即时 | 每个操作都有视觉/音效反馈 |
| 便捷操作 | 核心功能2步内可达 |

### 5.3 通知策略
| 场景 | 通知内容 | 频率限制 |
|------|---------|---------|
| 体征过低 | "你的饱食度过低，请尽快进食" | 每2小时最多1次 |
| 建造完成 | "你的[建筑名]已建造完成" | 无限制 |
| 交易成功 | "[玩家名]接受了你的交易" | 无限制 |
| 领地警告 | "你的[领地名]即将被回收" | 每天1次 |

---

## 6. 技术实现要点

### 6.1 GPS定位优化
- 使用Kalman滤波平滑GPS抖动
- 多点采样取平均减少误差
- 速度异常检测防止作弊

### 6.2 地理数据处理
- 使用PostGIS存储多边形领地数据
- 空间索引加速"附近查询"
- 领地重叠检测使用ST_Intersects

### 6.3 实时通讯
- 使用Supabase Realtime实现消息推送
- 基于位置的消息分发（减少服务器压力）
- 消息缓存机制处理离线情况

### 6.4 本地优先架构
- 背包数据本地SQLite缓存
- 网络恢复后增量同步
- 冲突解决：服务器优先

---

## 7. 扩展规划

### 7.1 未来功能
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 联盟系统 | 玩家组建联盟，共享领地收益 | 高 |
| PvE任务 | 限时探索任务，稀有奖励 | 中 |
| 天气系统 | 真实天气影响游戏（雨天减少火焰消耗） | 中 |
| 季节活动 | 节日限定活动和奖励 | 高 |
| AR模式 | AR相机查看领地和建筑 | 低 |

### 7.2 内容更新节奏
| 更新类型 | 频率 | 内容 |
|---------|------|------|
| 热修复 | 随时 | Bug修复 |
| 小版本 | 每2周 | 平衡调整、小功能 |
| 大版本 | 每2月 | 新系统、新建筑、新活动 |
| 赛季更新 | 每季度 | 主题赛季、排行榜重置 |

---

## 附录A：核心代码模块对照

| 游戏系统 | 核心代码文件 | 主要职责 |
|---------|-------------|---------|
| 用户认证 | AuthManager.swift | 登录、注册、会话管理 |
| GPS定位 | LocationManager.swift | 位置追踪、轨迹记录 |
| 领地管理 | TerritoryManager.swift | 领地创建、验证、状态管理 |
| POI系统 | POIManager.swift | 地标发现、搜刮逻辑 |
| 探索系统 | ExplorationManager.swift | 探索记录、奖励计算 |
| 背包系统 | ItemManager.swift | 物品存储、使用、同步 |
| 建造系统 | BuildingManager.swift | 建筑创建、升级、维护 |
| 交易系统 | TradeManager.swift | 挂单、匹配、交换 |
| 消息系统 | RadioManager.swift | 系统消息、推送 |
| 聊天系统 | CommunicationManager.swift | 实时消息收发 |
| 频道系统 | ChannelManager.swift | 频道创建、加入、管理 |
| 支付系统 | StoreKitManager.swift | 订阅、内购处理 |
| 排行榜 | LeaderboardManager.swift | 排名计算、缓存 |
| 成就系统 | AchievementManager.swift | 成就检测、解锁、奖励 |
| 生存体征 | VitalSignsManagerV2.swift | 体征计算、衰减、恢复 |

---

## 附录B：术语表

| 术语 | 定义 |
|------|------|
| LBS | Location-Based Service，基于位置的服务 |
| POI | Point of Interest，兴趣点/地标 |
| PTT | Push-To-Talk，按键说话 |
| GPS | Global Positioning System，全球定位系统 |
| 圈地 | 玩家通过行走绘制领地边界的行为 |
| 开拓者 | 游戏中对玩家的称呼 |
| 希望朋克 | 本游戏的视觉风格，废土中的希望 |

---

**文档结束**

# 《地球新章》产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2025年12月25日
**产品名称**: 地球新章 (DQXZ)
**平台**: iOS

---

## 1. 产品概述

### 1.1 产品定位
《地球新章》是一款基于真实地理位置的末日生存手游，融合了GPS定位、社交互动、资源管理和策略建造等核心玩法。玩家通过现实世界的行走来圈占虚拟领地，探索真实地标获取资源，与其他玩家交易合作，共同重建末日后的新文明。

### 1.2 目标用户
| 用户类型 | 特征描述 |
|---------|---------|
| 核心用户 | 18-35岁，喜欢户外活动、生存游戏的玩家 |
| 次核心用户 | 对LBS游戏（如宝可梦GO）感兴趣的休闲玩家 |
| 潜在用户 | 希望通过游戏化方式增加运动量的健康人群 |

### 1.3 产品目标
- **短期目标**: 完成核心功能开发，实现基础游戏循环
- **中期目标**: 建立活跃的玩家社区，日活跃用户达到10万
- **长期目标**: 拓展全球市场，实现可持续的商业变现

---

## 2. 产品背景故事

### 2.1 世界观设定
- **2048年**: "终末战争"爆发，全球文明在72小时内崩塌，99%人口消失
- **2051年**: 幸存者从废墟中走出，《新开拓者协议》颁布
- **核心法则**: "凡以双足丈量之无主土地，皆为开拓者所有"

### 2.2 视觉风格
**"希望朋克"** — 废土之上的新生，绝望中的希望
- 破败建筑与新生植物并存
- 末日氛围与温暖色调结合
- 卫星地图风格的UI界面

---

## 3. 功能需求

### 3.1 用户账户系统

#### 3.1.1 登录注册
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| AUTH-001 | 邮箱注册登录（用户名+密码） | P0 |
| AUTH-002 | Apple ID一键登录 | P0 |
| AUTH-003 | Google账号登录 | P0 |
| AUTH-004 | 密码找回功能 | P1 |
| AUTH-005 | 多设备登录管理 | P2 |

**技术方案**: 使用Supabase Auth实现

#### 3.1.2 用户信息
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| USER-001 | 用户昵称设置与修改 | P0 |
| USER-002 | 头像上传与管理 | P1 |
| USER-003 | 开拓者档案展示 | P0 |

---

### 3.2 GPS圈地系统

#### 3.2.1 圈地功能
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| LAND-001 | 开始圈地：记录起始GPS坐标 | P0 |
| LAND-002 | 实时轨迹绘制：蓝色线条显示行走路径 | P0 |
| LAND-003 | 自动闭合：接近起点时自动成多边形 | P0 |
| LAND-004 | 面积计算：显示圈定区域面积（平方米） | P0 |
| LAND-005 | 合法性验证：检测是否与他人领地重叠 | P0 |
| LAND-006 | 防作弊检测：GPS速度异常检测 | P1 |

**用户故事**:
> 作为玩家，我希望通过现实行走来圈定虚拟领地，这样我可以感受到真实的"领土扩张"成就感。

#### 3.2.2 领地管理
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| LAND-010 | 领地命名：给领地设置自定义名称 | P0 |
| LAND-011 | 领地详情：查看面积、建筑数量等信息 | P0 |
| LAND-012 | 交易开关：设置是否允许其他玩家在此交易 | P1 |
| LAND-013 | 活跃度要求：30天内需开始建设，90天保持活跃 | P1 |

---

### 3.3 探索与搜刮系统

#### 3.3.1 POI发现
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| POI-001 | 自动识别附近真实地标（使用Apple MapKit） | P0 |
| POI-002 | POI类型标识：医院、超市、工厂、公园、银行等 | P0 |
| POI-003 | 距离检测：进入POI 50米范围内触发发现 | P0 |
| POI-004 | 发现提示：弹出"发现兴趣点"提示框 | P0 |

#### 3.3.2 搜刮机制
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| POI-010 | 搜刮按钮：点击获取对应资源 | P0 |
| POI-011 | 资源类型映射 | P0 |
| POI-012 | 探索成就：记录探索距离、时长 | P1 |
| POI-013 | 冷却时间：同一POI搜刮间隔限制 | P1 |

**POI资源映射表**:
| POI类型 | 产出资源 |
|---------|---------|
| 医院/药店 | 药品、急救包、抗生素 |
| 超市/餐厅 | 罐头食品、饮用水 |
| 工厂/工地 | 金属材料、工具 |
| 公园/林地 | 木材、植物纤维 |
| 银行/珠宝店 | 稀有材料、电子元件 |

---

### 3.4 背包系统

| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| INV-001 | 背包容量：初始100格，可扩展 | P0 |
| INV-002 | 物品分类：食物、药品、材料、工具等 | P0 |
| INV-003 | 物品堆叠：同类物品自动合并 | P0 |
| INV-004 | 容量显示：已用/总容量进度条 | P0 |
| INV-005 | 物品使用：消耗类物品直接使用 | P0 |
| INV-006 | 物品丢弃：手动丢弃多余物品 | P1 |
| INV-007 | 离线同步：本地优先存储，联网后同步 | P1 |

---

### 3.5 建造系统

#### 3.5.1 建筑建造
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| BUILD-001 | 建筑列表：展示可建造建筑及所需资源 | P0 |
| BUILD-002 | 资源检查：验证背包资源是否足够 | P0 |
| BUILD-003 | 位置选择：在领地内拖动选择建造位置 | P0 |
| BUILD-004 | 建造确认：消耗资源，开始建造 | P0 |
| BUILD-005 | 建造时间：不同建筑有不同建造时长 | P1 |

**建筑分类**:
| 类别 | 建筑示例 | 功能描述 |
|------|---------|---------|
| 生存类 | 篝火、庇护所 | 取暖、休息恢复 |
| 储存类 | 小仓库、中仓库 | 扩展存储容量 |
| 生产类 | 农田、工作台 | 生产资源 |
| 能源类 | 太阳能板、风力发电机 | 提供电力 |

#### 3.5.2 建筑状态管理
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| BUILD-010 | 状态机：建造中→待激活→运行中→损坏 | P0 |
| BUILD-011 | 激活操作：完成建造后需手动激活 | P0 |
| BUILD-012 | 维护需求：定期消耗资源维护 | P1 |
| BUILD-013 | 升级功能：只有激活状态可升级 | P1 |

---

### 3.6 交易系统

| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| TRADE-001 | 发布挂单：选择"我提供"和"我需要"的物品 | P0 |
| TRADE-002 | 挂单列表：查看当前区域所有挂单 | P0 |
| TRADE-003 | 距离限制：100米范围内才能看到对方挂单 | P0 |
| TRADE-004 | 接受交易：双方物品自动交换 | P0 |
| TRADE-005 | 取消挂单：撤回未完成的交易 | P1 |
| TRADE-006 | 交易历史：查看历史交易记录 | P2 |

---

### 3.7 通讯系统

#### 3.7.1 消息中心
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| MSG-001 | 官方消息：生存指南、每日任务、公告 | P0 |
| MSG-002 | 系统通知：交易完成、建造完成等 | P0 |
| MSG-003 | 未读标记：显示未读消息数量 | P0 |

#### 3.7.2 公共频道
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| CHAT-001 | 范围限制：3km范围内玩家可见 | P0 |
| CHAT-002 | 实时消息：秒级消息送达 | P0 |
| CHAT-003 | 消息发送：文字消息输入发送 | P0 |
| CHAT-004 | 消息列表：时间序展示历史消息 | P0 |

#### 3.7.3 频道管理
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| CHAN-001 | 频道列表：展示可加入的频道 | P0 |
| CHAN-002 | 创建频道：设置频道名称和描述 | P1 |
| CHAN-003 | 加入/退出：一键加入或退出频道 | P0 |
| CHAN-004 | 频道聊天：频道内实时聊天 | P0 |

#### 3.7.4 PTT呼叫
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| PTT-001 | 长按说话：模拟对讲机操作 | P1 |
| PTT-002 | 语音转文字：语音消息转为文字发送 | P2 |
| PTT-003 | 频率选择：选择公共频道或私人频道 | P1 |

#### 3.7.5 通讯设备等级
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| DEV-001 | 收音机：只能接收，不能发送 | P0 |
| DEV-002 | 对讲机：可收发，范围3km | P0 |
| DEV-003 | 营地电台：范围10km | P1 |
| DEV-004 | 卫星通讯：全球范围 | P1 |
| DEV-005 | 设备升级：消耗资源升级设备 | P0 |

---

### 3.8 个人中心

#### 3.8.1 个人主页
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| PROF-001 | 开拓者档案：等级、存活天数 | P0 |
| PROF-002 | 领地统计：领地数量、总面积 | P0 |
| PROF-003 | 建筑统计：建筑数量 | P0 |

#### 3.8.2 生存体征
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| VITAL-001 | 核心生命值：0-100，降到0死亡 | P0 |
| VITAL-002 | 饱食度：随时间下降，每小时-5 | P0 |
| VITAL-003 | 水分：随时间下降，每小时-10 | P0 |
| VITAL-004 | 状态buff：>80%时获得增益 | P1 |
| VITAL-005 | 消耗恢复：使用食物/水恢复数值 | P0 |

#### 3.8.3 成就系统
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| ACH-001 | 成就列表：分类展示所有成就 | P0 |
| ACH-002 | 完成度：显示总完成百分比 | P0 |
| ACH-003 | 成就解锁：满足条件自动解锁 | P0 |
| ACH-004 | 奖励领取：解锁后获得金币奖励 | P0 |
| ACH-005 | 稀有度分级：普通→稀有→史诗→传说 | P1 |

#### 3.8.4 排行榜
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| RANK-001 | 领地面积榜 | P0 |
| RANK-002 | 探索废墟榜 | P0 |
| RANK-003 | 建筑数量榜 | P0 |
| RANK-004 | 个人排名：显示自己的排名位置 | P0 |
| RANK-005 | 定时刷新：5分钟更新一次 | P1 |

---

### 3.9 设置功能

| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| SET-001 | 多语言：简体中文、繁体中文、English | P0 |
| SET-002 | 语言切换：重启应用应用新语言 | P0 |
| SET-003 | 通知设置：开关各类推送通知 | P1 |
| SET-004 | 账号管理：退出登录、删除账号 | P1 |

---

### 3.10 商业化系统

#### 3.10.1 订阅制
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| PAY-001 | 开拓者月卡 $9.99/月：无限探索、范围扩大 | P0 |
| PAY-002 | 领主通行证 $19.99/月：所有特权 | P0 |
| PAY-003 | 订阅管理：查看、取消订阅 | P0 |

#### 3.10.2 一次性购买
| 需求ID | 功能描述 | 优先级 |
|--------|---------|--------|
| PAY-010 | 初级物资包 $0.99 | P0 |
| PAY-011 | 中级物资包 $2.99 | P0 |
| PAY-012 | 稀有资源包 $9.99 | P0 |
| PAY-013 | 购买确认：使用StoreKit 2完成支付 | P0 |

---

## 4. 非功能需求

### 4.1 性能需求
| 需求项 | 指标 |
|--------|------|
| GPS定位精度 | ≤10米 |
| GPS采样频率 | 1次/秒 |
| 消息送达延迟 | ≤2秒 |
| 排行榜查询 | ≤500ms |
| 应用启动时间 | ≤3秒 |

### 4.2 安全需求
- 用户密码加密存储
- API通信使用HTTPS
- 防GPS欺骗检测
- 敏感操作二次验证

### 4.3 兼容性
- iOS 15.0及以上
- 支持iPhone 8及更新机型
- 需要GPS、网络权限

---

## 5. 技术架构

### 5.1 核心技术栈
| 模块 | 技术方案 |
|------|---------|
| 前端框架 | SwiftUI |
| 地图服务 | Apple MapKit |
| 后端服务 | Supabase |
| 数据库 | PostgreSQL + PostGIS |
| 实时通讯 | Supabase Realtime |
| 支付系统 | StoreKit 2 |
| 用户认证 | Supabase Auth |

### 5.2 核心代码模块
| 功能模块 | 核心文件 |
|---------|---------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 6. 版本规划

### 6.1 MVP版本 (v1.0)
- 登录注册系统
- GPS圈地核心功能
- 基础探索搜刮
- 背包系统
- 基础建造功能

### 6.2 社交版本 (v1.5)
- 交易系统
- 公共频道聊天
- 频道管理
- PTT呼叫

### 6.3 商业化版本 (v2.0)
- 订阅系统
- 内购商店
- 排行榜
- 成就系统
- 多语言支持

---

## 7. 风险与对策

| 风险 | 对策 |
|------|------|
| GPS定位不准确 | 采用多点平滑算法，增加定位精度 |
| 用户作弊（模拟GPS） | 速度异常检测，轨迹合理性验证 |
| 服务器压力 | 使用Supabase云服务，自动扩容 |
| 地图数据覆盖不全 | 依赖Apple MapKit全球数据 |

---

**文档结束**
